<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta http-equiv=Content-Security-Policy content="default-src 'none'; style-src 'self' 'unsafe-inline'; img-src 'self' https:; font-src 'self'; script-src 'unsafe-inline'"><link rel="shortcut icon" type=image/png href=/favicon.png><link rel=sitemap type=application/xml href=/sitemap.xml title=knrdlog><title>Wayland: Auto-clean clipboard</title><meta name=description content="notes to self"><meta property="og:url" content="https://knrdl.github.io/posts/wayland-clipboard-clean/"><meta property="og:site_name" content="knrdlog"><meta property="og:title" content="Wayland: Auto-clean clipboard"><meta property="og:description" content="Wayland has the safety feature of clearing the clipboard if you close the source window (where the content was copied from). Password managers (like KeePass) also give you only a few seconds to paste the password somewhere before clearing the clipboard. But in day-to-day life, you might need to copy secrets and tokens outside a password manager. To prevent accidental pastes, these values should not stay in the clipboard forever. A manual attempt is to overwrite the clipboard by copying something harmless afterwards, but thatâ€™s not very fault-tolerant. The automatic solution is to clear the clipboard if the last copy action is older than a certain delay."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-04T00:00:00+00:00"><meta property="article:modified_time" content="2024-01-04T21:56:09+01:00"><meta property="article:tag" content="Wayland"><meta property="article:tag" content="Clipboard"><meta property="article:tag" content="Bash"><meta name=author content="knrdl"><link rel=stylesheet href=https://knrdl.github.io/styles.min.b1eb305989f01c7be31a7a19d4ab34ca470eddd06327253c7bcf3d1c5a41d28c.css integrity="sha256-seswWYnwHHvjGnoZ1Ks0ykcO3dBjJyU8e889HFpB0ow="></head><body><header><div class=site-header><span><a href=https://knrdl.github.io/ class=site-title>knrdlog</a>
</span><span><nav class=right-menu><span class=menu-item><a href=/tags/>tags</a></span>
<span class=menu-item><a href=https://github.com/knrdl target=_blank rel="noopener noreferrer">github</a></span>
<span class=menu-item><a href=/index.xml>rss</a></span></nav></span></div><div class=separator>================================================================================================================================================================</div></header><main><article><div class=post-header><h1>Wayland: Auto-clean clipboard</h1><time datetime=2024-01-04 class=pubdate>2024-01-04</time>
<span class=tags><a href=/tags/bash class=hashtag>bash</a>
<a href=/tags/clipboard class=hashtag>clipboard</a>
<a href=/tags/wayland class=hashtag>wayland</a></span></div><p>Wayland has the safety feature of clearing the clipboard if you close the source window (where the content was copied from). Password managers (like KeePass) also give you only a few seconds to paste the password somewhere before clearing the clipboard. But in day-to-day life, you might need to copy secrets and tokens outside a password manager. To prevent accidental pastes, these values should not stay in the clipboard forever. A manual attempt is to overwrite the clipboard by copying something harmless afterwards, but that&rsquo;s not very fault-tolerant. The automatic solution is to clear the clipboard if the last copy action is older than a certain delay.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo apt install wl-clipboard
</span></span></code></pre></div><p>Executable file <code>/usr/local/bin/clipboard-cleaner-handler</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#ff79c6>#!/bin/dash
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># remove previous delay handlers</span>
</span></span><span style=display:flex><span>pgrep -f -x <span style=color:#f1fa8c>&#34;/bin/dash </span><span style=color:#8be9fd;font-style:italic>$0</span><span style=color:#f1fa8c>&#34;</span> | grep -v ^<span style=color:#8be9fd;font-style:italic>$$</span><span style=color:#f1fa8c>\$</span> | <span style=color:#ff79c6>while</span> <span style=color:#8be9fd;font-style:italic>read</span> pid ; <span style=color:#ff79c6>do</span> 
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>kill</span> <span style=color:#8be9fd;font-style:italic>$pid</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sleep <span style=color:#bd93f9>45</span>  <span style=color:#6272a4># &lt;- the delay</span>
</span></span><span style=display:flex><span>wl-copy -c
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>echo</span> cleared clipboard
</span></span></code></pre></div><p>Executable file <code>/usr/local/bin/clipboard-cleaner</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#ff79c6>#!/bin/dash
</span></span></span><span style=display:flex><span>wl-paste -w /bin/dash -c <span style=color:#f1fa8c>&#39;/usr/local/bin/clipboard-cleaner-handler &amp;&#39;</span>
</span></span></code></pre></div><p>Finally put <code>clipboard-cleaner</code> into autostart.</p><p>How does it work: <code>wl-paste</code> watches for clipboard copy events and executes <code>clipboard-cleaner-handler</code> each time without blocking the listening. <code>clipboard-cleaner-handler</code> first removes all invocations of itself from previous copy events. Then it waits for the delay before cleaning the clipboard. That way, only the last triggered delay actually counts.</p><div class=comments><a href="https://github.com/knrdl/knrdl.github.io/issues/new?title=Wayland%3A+Auto-clean+clipboard" target=_blank rel="noopener noreferrer"><img src=https://knrdl.github.io/github.png alt="Github logo" style=filter:invert(.7) width=17 height=17>
<span>Feedback</span></a></div></article></main><hr><footer>Licensed under <a href=https://creativecommons.org/publicdomain/zero/1.0/ target=_blank rel='noopener norefferer'>CC0 1.0</a> |
<a href=https://gohugo.io target=_blank rel='noopener norefferer'>Hugo</a> theme inspired by <a href=https://github.com/vamc19 target=_blank rel='noopener norefferer'>vamc19</a> |
Hosted by <a href=https://pages.github.com target=_blank rel='noopener norefferer'>Github</a> (<a href=https://github.com/site/privacy target=_blank rel='noopener norefferer'>Privacy Policy</a>)</footer></body></html>