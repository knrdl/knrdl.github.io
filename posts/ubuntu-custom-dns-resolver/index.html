<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta http-equiv=Content-Security-Policy content="default-src 'none'; style-src 'self' 'unsafe-inline'; img-src 'self' https:; font-src 'self'; script-src 'unsafe-inline'"><link rel="shortcut icon" type=image/png href=/favicon.png><link rel=sitemap type=application/xml href=/sitemap.xml title=knrdlog><title>Ubuntu: configure custom dns resolver</title>
<meta name=description content="notes to self"><meta property="og:title" content="Ubuntu: configure custom dns resolver"><meta property="og:description" content="DNS provisioning mostly works out of the box. But once for a cloud instance the DNS resolver had terrible response times. So I added another resolver.
Ubuntu uses netplan as abstraction layer for network config.
sudo nano /etc/netplan/01-netcfg.yaml
... nameservers: search: [ invalid ] addresses: - 127.0.0.1 # the new resolver - 123.123.123.1 # provided dns resolver - 223.123.123.2 # provided dns resolver For a containerized DNS resolver see here."><meta property="og:type" content="article"><meta property="og:url" content="https://knrdl.github.io/posts/ubuntu-custom-dns-resolver/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-22T00:00:00+00:00"><meta property="article:modified_time" content="2022-12-26T17:23:43+01:00"><meta name=author content="knrdl"><link rel=stylesheet href=https://knrdl.github.io/styles.min.b1eb305989f01c7be31a7a19d4ab34ca470eddd06327253c7bcf3d1c5a41d28c.css integrity="sha256-seswWYnwHHvjGnoZ1Ks0ykcO3dBjJyU8e889HFpB0ow="></head><body><header><div class=site-header><span><a href=https://knrdl.github.io/ class=site-title>knrdlog</a>
</span><span><nav class=right-menu><span class=menu-item><a href=/tags/>tags</a></span>
<span class=menu-item><a href=https://github.com/knrdl target=_blank rel="noopener noreferrer">github</a></span>
<span class=menu-item><a href=/index.xml>rss</a></span></nav></span></div><div class=separator>================================================================================================================================================================</div></header><main><article><div class=post-header><h1>Ubuntu: configure custom dns resolver</h1><time datetime=2022-12-22 class=pubdate>2022-12-22</time>
<a href=https://github.com/knrdl/knrdl.github.io/commits/main/content/posts/ubuntu-custom-dns-resolver.md target=_blank rel="noopener noreferrer"><time datetime=2022-12-26 class=lastmod>{üìù2022-12-26}
</time></a><span class=tags><a href=/tags/dns class=hashtag>dns</a>
<a href=/tags/netplan class=hashtag>netplan</a>
<a href=/tags/ubuntu class=hashtag>ubuntu</a></span></div><p>DNS provisioning mostly works out of the box. But once for a cloud instance the DNS resolver had terrible response times. So I added another resolver.</p><p>Ubuntu uses <code>netplan</code> as abstraction layer for network config.</p><p><code>sudo nano /etc/netplan/01-netcfg.yaml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#ff79c6>nameservers</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>search</span>: [ invalid ]
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>addresses</span>:
</span></span><span style=display:flex><span>    - <span style=color:#bd93f9>127.0.0.1</span>  <span style=color:#6272a4># the new resolver</span>
</span></span><span style=display:flex><span>    - <span style=color:#bd93f9>123.123.123.1</span>  <span style=color:#6272a4># provided dns resolver </span>
</span></span><span style=display:flex><span>    - <span style=color:#bd93f9>223.123.123.2</span>  <span style=color:#6272a4># provided dns resolver</span>
</span></span></code></pre></div><p>For a containerized DNS resolver see
<a href=https://github.com/knrdl/unbound-dns-server target=_blank rel="noopener noreferrer">here</a>.</p><blockquote><p class=warning>DNS resolvers should NOT be exposed to public networks (dns amplification attacks etc.)! So make sure to bind the dns server socket to localhost or the local network.</p></blockquote><p>Finally, run: <code>sudo netplan apply</code></p><p>Check which DNS resolver is currently in use: <code>sudo resolvectl status eth0</code> (filter for network interface <code>eth0</code> is optional)</p><div class=comments><a href="https://github.com/knrdl/knrdl.github.io/issues/new?title=Ubuntu%3A+configure+custom+dns+resolver" target=_blank rel="noopener noreferrer"><img src=https://knrdl.github.io/github.png alt="Github logo" style=filter:invert(.7) width=17 height=17>
<span>Feedback</span></a></div></article></main><hr><footer>Licensed under <a href=https://creativecommons.org/publicdomain/zero/1.0/ target=_blank rel='noopener norefferer'>CC0 1.0</a> |
<a href=https://gohugo.io target=_blank rel='noopener norefferer'>Hugo</a> theme inspired by <a href=https://github.com/vamc19 target=_blank rel='noopener norefferer'>vamc19</a> |
Hosted by <a href=https://pages.github.com target=_blank rel='noopener norefferer'>Github</a> (<a href=https://github.com/site/privacy target=_blank rel='noopener norefferer'>Privacy Policy</a>)</footer></body></html>