<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=content-security-policy content="default-src 'none'; style-src 'self' 'unsafe-inline'; img-src 'self' https:; font-src 'self'; script-src 'unsafe-inline'"><link rel="shortcut icon" type=image/png href=/favicon.png><link rel=sitemap type=application/xml href=/sitemap.xml title=knrdlog><title>Rootless Docker as a Service</title><meta name=description content="notes to self"><meta property="og:title" content="Rootless Docker as a Service"><meta property="og:description" content="Sometimes access to a docker daemon on a remote host is needed, e.g. a developer without docker on local machine or a CI/CD pipeline to test docker image runtime behaviour.
Exposing the docker socket of the remote host This could be done via TCP directly by docker, or indirectly via tcp socket to unix socket redirect:
socat TODO The lack of authentication means everybody on the network can get trivially root access on the host (via starting a docker container)."><meta property="og:type" content="article"><meta property="og:url" content="https://knrdl.github.io/posts/rootless-docker-as-a-service/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-04-11T00:00:00+00:00"><meta property="article:modified_time" content="2022-10-03T21:24:55+02:00"><meta name=author content="knrdl"><link rel=stylesheet href=https://knrdl.github.io/styles.min.d0a5c24e5cf581dcf65611cb27dfd4799b0cbdc02e48197a144ef1eba4c2166d.css integrity="sha256-0KXCTlz1gdz2VhHLJ9/UeZsMvcAuSBl6FE7x66TCFm0="></head><body><header><div class=site-header><span><a href=https://knrdl.github.io/ class=site-title>knrdlog</a></span>
<span><nav class=right-menu><span class=menu-item><a href=/tags/>tags</a></span>
<span class=menu-item><a href=https://github.com/knrdl target=_blank rel="noopener noreferrer">github</a></span>
<span class=menu-item><a href=/index.xml>rss</a></span></nav></span></div><div class=separator>================================================================================================================================================================</div></header><main><article><div class=post-header><h1>Rootless Docker as a Service</h1><time datetime=2022-04-11 class=pubdate>2022-04-11</time>
<time datetime=2022-10-03 class=lastmod>[Updated 2022-10-03]</time>
<span class=tags><a href=/tags/devops class=hashtag>devops</a>
<a href=/tags/docker class=hashtag>docker</a></span></div><p>Sometimes access to a docker daemon on a remote host is needed, e.g. a developer without docker on local machine or a
CI/CD pipeline to test docker image runtime behaviour.</p><h2 id=exposing-the-docker-socket-of-the-remote-host class=paragraph-header>Exposing the docker socket of the remote host <a href=#exposing-the-docker-socket-of-the-remote-host></a></h2><p>This could be done via TCP directly by docker, or indirectly via tcp socket to unix socket redirect:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>socat TODO
</span></span></code></pre></div><p>The lack of authentication means everybody on the network can get trivially root access on the host (via starting a
docker container). As a countermeasure the tcp socket can be tunneled via e.g. SSH:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#6272a4># server:</span>
</span></span><span style=display:flex><span>socat TODO
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># client:</span>
</span></span><span style=display:flex><span>ssh TODO
</span></span></code></pre></div><p>But this still means giving the client full root access to the host</p><h2 id=rootless-docker-in-a-docker-container class=paragraph-header>Rootless Docker in a Docker container <a href=#rootless-docker-in-a-docker-container></a></h2><p>Docker in Docker (DinD) is nothing new. But since v19.03 docker supports rootless mode (stable in
v20.10). So an unprivileged container can be started</p><p>todo: problem container au√üen ist immernoch priviligiert</p><div class=comments><a href="https://github.com/knrdl/knrdl.github.io/issues/new?title=Rootless+Docker+as+a+Service" target=_blank rel="noopener noreferrer"><img src=https://knrdl.github.io/github.png alt="Github logo" style=filter:invert(.7) width=17 height=17>
<span>Feedback</span></a></div></article></main><hr><footer>Licensed under <a href=https://creativecommons.org/publicdomain/zero/1.0/ target=_blank rel='noopener norefferer'>CC0 1.0</a> |
<a href=https://gohugo.io target=_blank rel='noopener norefferer'>Hugo</a> theme inspired by <a href=https://github.com/vamc19 target=_blank rel='noopener norefferer'>vamc19</a> |
Hosted by <a href=https://pages.github.com target=_blank rel='noopener norefferer'>Github</a> (<a href=https://github.com/site/privacy target=_blank rel='noopener norefferer'>Privacy Policy</a>)</footer></body></html>