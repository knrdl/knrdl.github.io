<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=content-security-policy content="default-src 'none'; style-src 'self' 'unsafe-inline'; img-src 'self' https:; font-src 'self'; script-src 'unsafe-inline'"><link rel="shortcut icon" type=image/png href=/favicon.png><link rel=sitemap type=application/xml href=/sitemap.xml title=knrdlog><title>Fix gitlab immense disk usage</title><meta name=description content="notes to self"><meta property="og:title" content="Fix gitlab immense disk usage"><meta property="og:description" content="The gitlab docker registry has no cleanup job per default. If an image tag gets overwritten (updated) then the original image layer blobs will be kept as orphans. To clean those up run:
gitlab-ctl registry-garbage-collect --delete-untagged --delete-manifest Automation run the command via Cron (the gitlab image contains go-crond) set command in env var GITLAB_POST_RECONFIGURE_SCRIPT (executed at least on each container start) Conclusion 170GiB server disk storage freed"><meta property="og:type" content="article"><meta property="og:url" content="https://knrdl.github.io/posts/gitlab-immense-disk-usage/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-02-28T00:00:00+00:00"><meta property="article:modified_time" content="2022-04-11T22:25:11+02:00"><meta name=author content="knrdl"><link rel=stylesheet href=https://knrdl.github.io/styles.min.b1eb305989f01c7be31a7a19d4ab34ca470eddd06327253c7bcf3d1c5a41d28c.css integrity="sha256-seswWYnwHHvjGnoZ1Ks0ykcO3dBjJyU8e889HFpB0ow="></head><body><header><div class=site-header><span><a href=https://knrdl.github.io/ class=site-title>knrdlog</a></span>
<span><nav class=right-menu><span class=menu-item><a href=/tags/>tags</a></span>
<span class=menu-item><a href=https://github.com/knrdl target=_blank rel="noopener noreferrer">github</a></span>
<span class=menu-item><a href=/index.xml>rss</a></span></nav></span></div><div class=separator>================================================================================================================================================================</div></header><main><article><div class=post-header><h1>Fix gitlab immense disk usage</h1><time datetime=2022-02-28 class=pubdate>2022-02-28</time>
<a href=https://github.com/knrdl/knrdl.github.io/commits/main/content/posts/gitlab-immense-disk-usage.md target=_blank rel="noopener noreferrer"><time datetime=2022-04-11 class=lastmod>{üìù2022-04-11}</time></a>
<span class=tags><a href=/tags/devops class=hashtag>devops</a>
<a href=/tags/docker class=hashtag>docker</a>
<a href=/tags/gitlab class=hashtag>gitlab</a></span></div><p>The gitlab docker registry has no cleanup job per default. If an image tag gets overwritten (updated) then the original
image layer blobs will be kept as orphans. To clean those up run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>gitlab-ctl registry-garbage-collect --delete-untagged --delete-manifest
</span></span></code></pre></div><h2 id=automation class=paragraph-header>Automation <a href=#automation></a></h2><ul><li>run the command via Cron (the gitlab image contains <code>go-crond</code>)</li><li>set command in env var <code>GITLAB_POST_RECONFIGURE_SCRIPT</code> (executed at least on each container start)</li></ul><h2 id=conclusion class=paragraph-header>Conclusion <a href=#conclusion></a></h2><p>170GiB server disk storage freed</p><div class=comments><a href="https://github.com/knrdl/knrdl.github.io/issues/new?title=Fix+gitlab+immense+disk+usage" target=_blank rel="noopener noreferrer"><img src=https://knrdl.github.io/github.png alt="Github logo" style=filter:invert(.7) width=17 height=17>
<span>Feedback</span></a></div></article></main><hr><footer>Licensed under <a href=https://creativecommons.org/publicdomain/zero/1.0/ target=_blank rel='noopener norefferer'>CC0 1.0</a> |
<a href=https://gohugo.io target=_blank rel='noopener norefferer'>Hugo</a> theme inspired by <a href=https://github.com/vamc19 target=_blank rel='noopener norefferer'>vamc19</a> |
Hosted by <a href=https://pages.github.com target=_blank rel='noopener norefferer'>Github</a> (<a href=https://github.com/site/privacy target=_blank rel='noopener norefferer'>Privacy Policy</a>)</footer></body></html>