<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=content-security-policy content="default-src 'none'; style-src 'self' 'unsafe-inline'; img-src 'self'; font-src 'self'"><link rel="shortcut icon" type=image/png href=/favicon.png><link rel=sitemap type=application/xml href=/sitemap.xml title=knrdlog><title>Linux Laptop: Wifi dependent profiles</title><meta name=description content="notes to self"><meta property="og:title" content="Linux Laptop: Wifi dependent profiles"><meta property="og:description" content="A notebook as mobile device may should behave differently depending on the location. Examples:
at home: sound output should be turned on a backup script can run from time to time in a foreign network / without connection: speakers should be muted a vpn connection should be established in public networks at work: speakers should be muted time tracking software should be active Evaluating the ssid (name) of the currently connected Wi-Fi on connection change is a cheap solution."><meta property="og:type" content="article"><meta property="og:url" content="https://knrdl.github.io/posts/linux-laptop-wifi-profiles/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-05T00:00:00+00:00"><meta property="article:modified_time" content="2022-05-06T00:20:36+02:00"><meta name=author content="knrdl"><link rel=stylesheet href=https://knrdl.github.io/style.min.04f851893e658e0184e5c88dc0cf82f809c75bdc7b13e27fe13d262eb488e27a.css integrity="sha256-BPhRiT5ljgGE5ciNwM+C+AnHW9x7E+J/4T0mLrSI4no="></head><body><header><div class=site-header><span><a href=https://knrdl.github.io/ class=site-title>knrdlog</a></span>
<span><nav class=right-menu><span class=menu-item>/<a href=https://github.com/knrdl target=_blank rel="noopener noreferrer">github</a></span>
<span class=menu-item>/<a href=/index.xml target=_blank rel="noopener noreferrer">rss</a></span></nav></span></div><div class=separator>================================================================================================================================================================</div></header><main><article><div class=post-header><h1>Linux Laptop: Wifi dependent profiles</h1><span class=pubdate>2022-05-05</span>
<span class=lastmod>[Updated 2022-05-06]</span>
<span class=tags><a href=/tags/bash class=hashtag>bash</a>
<a href=/tags/linux class=hashtag>linux</a>
<a href=/tags/network-manager class=hashtag>network-manager</a>
<a href=/tags/wifi class=hashtag>wifi</a></span></div><p>A notebook as mobile device may should behave differently depending on the location. Examples:</p><ul><li>at home:<ul><li>sound output should be turned on</li><li>a backup script can run from time to time</li></ul></li><li>in a foreign network / without connection:<ul><li>speakers should be muted</li><li>a vpn connection should be established in public networks</li></ul></li><li>at work:<ul><li>speakers should be muted</li><li>time tracking software should be active</li></ul></li></ul><p>Evaluating the ssid (name) of the currently connected Wi-Fi on connection change is a cheap solution. This can be done
by using a hook of the network manager.</p><ol><li>Create file <code>/etc/NetworkManager/dispatcher.d/90-wifi-profiles</code> (replace 3x <code>yourname</code>)</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#ff79c6>#!/usr/bin/env bash
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>interface</span><span style=color:#ff79c6>=</span><span style=color:#8be9fd;font-style:italic>$1</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>event</span><span style=color:#ff79c6>=</span><span style=color:#8be9fd;font-style:italic>$2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># only listen to connect/disconnect events</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>[[</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$event</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#34;connectivity-change&#34;</span> <span style=color:#ff79c6>]]</span> <span style=color:#ff79c6>||</span> <span style=color:#8be9fd;font-style:italic>exit</span> <span style=color:#bd93f9>0</span>   
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># check user is logged in</span>
</span></span><span style=display:flex><span>who | awk <span style=color:#f1fa8c>&#39;{print $1}&#39;</span> | grep -q <span style=color:#f1fa8c>&#39;^yourname$&#39;</span> <span style=color:#ff79c6>||</span> <span style=color:#8be9fd;font-style:italic>exit</span> <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo -u yourname /home/yourname/.wifi-profile &gt;&gt; /var/log/wifi-profiles 2&gt;&amp;<span style=color:#bd93f9>1</span>
</span></span></code></pre></div><p>and run</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sudo chown root:root /etc/NetworkManager/dispatcher.d/90-wifi-profiles
</span></span><span style=display:flex><span>$ sudo chmod o+x /etc/NetworkManager/dispatcher.d/90-wifi-profiles
</span></span></code></pre></div><ol start=2><li>Create <code>~/.wifi-profile</code></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#ff79c6>#!/usr/bin/env bash
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span><span style=color:#6272a4># user specific env vars need to be set manually!</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>XDG_RUNTIME_DIR</span><span style=color:#ff79c6>=</span>/run/user/1000
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>DISPLAY</span><span style=color:#ff79c6>=</span>:0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>function</span> soundOff<span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>  amixer -D pulse sset Master mute
</span></span><span style=display:flex><span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>function</span> soundOn<span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>  amixer -D pulse sset Master 40%
</span></span><span style=display:flex><span>  amixer -D pulse sset Master unmute
</span></span><span style=display:flex><span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>function</span> askConnectVpn<span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>  zenity --question --title <span style=color:#f1fa8c>&#34;Foreign Wifi&#34;</span> --text <span style=color:#f1fa8c>&#34;Connect to home VPN?&#34;</span> <span style=color:#ff79c6>&amp;&amp;</span> nmcli con up id yourvpn
</span></span><span style=display:flex><span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>SSID</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>$(</span>iwgetid -r<span style=color:#ff79c6>)</span><span style=color:#f1fa8c>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>if</span> <span style=color:#ff79c6>[[</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$SSID</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;home_network1&#39;</span> <span style=color:#ff79c6>||</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$SSID</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;home_network2&#39;</span> <span style=color:#ff79c6>]]</span>; <span style=color:#ff79c6>then</span>  <span style=color:#6272a4># at home</span>
</span></span><span style=display:flex><span>  soundOn  <span style=color:#6272a4># use carefully, might not be wanted</span>
</span></span><span style=display:flex><span>  <span style=color:#6272a4># run backup</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>elif</span> <span style=color:#ff79c6>[[</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$SSID</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;work_network1&#39;</span> <span style=color:#ff79c6>||</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$SSID</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;work_network2&#39;</span> <span style=color:#ff79c6>]]</span>; <span style=color:#ff79c6>then</span>  <span style=color:#6272a4># at work</span>
</span></span><span style=display:flex><span>  soundOff
</span></span><span style=display:flex><span><span style=color:#ff79c6>elif</span> <span style=color:#ff79c6>[[</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$SSID</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;&#39;</span> <span style=color:#ff79c6>]]</span>; <span style=color:#ff79c6>then</span>  <span style=color:#6272a4># not connected</span>
</span></span><span style=display:flex><span>  soundOff
</span></span><span style=display:flex><span><span style=color:#ff79c6>else</span>  <span style=color:#6272a4># foreign network</span>
</span></span><span style=display:flex><span>  soundOff
</span></span><span style=display:flex><span>  askConnectVpn
</span></span><span style=display:flex><span><span style=color:#ff79c6>fi</span>
</span></span></code></pre></div><p>and run</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ chmod o+x ~/.wifi-profile
</span></span></code></pre></div><ol start=3><li>Test</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ sudo /etc/NetworkManager/dispatcher.d/90-wifi-profiles wlan0 connectivity-change
</span></span><span style=display:flex><span>$ cat /var/log/wifi-profiles
</span></span></code></pre></div><div class=comments><a href="https://github.com/knrdl/knrdl.github.io/issues/new?title=Linux+Laptop%3A+Wifi+dependent+profiles" target=_blank rel="noopener noreferrer"><img src=https://knrdl.github.io/github.png alt="Github logo" style=filter:invert(.7) width=17 height=17>
<span>Feedback</span></a></div></article></main><hr><footer>Licensed under <a href=https://creativecommons.org/publicdomain/zero/1.0/ target=_blank rel='noopener norefferer'>CC0 1.0</a> |
<a href=https://gohugo.io target=_blank rel='noopener norefferer'>Hugo</a> theme by <a href=https://github.com/vamc19 target=_blank rel='noopener norefferer'>vamc19</a> |
Hosted by <a href=https://pages.github.com target=_blank rel='noopener norefferer'>Github</a> (<a href=https://github.com/site/privacy target=_blank rel='noopener norefferer'>Privacy Policy</a>)</footer></body></html>