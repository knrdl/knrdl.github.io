<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta http-equiv=Content-Security-Policy content="default-src 'none'; style-src 'self' 'unsafe-inline'; img-src 'self' https:; font-src 'self'; script-src 'unsafe-inline'"><link rel="shortcut icon" type=image/png href=/favicon.png><link rel=sitemap type=application/xml href=/sitemap.xml title=knrdlog><title>PinePhone as edge server in a remote network</title>
<meta name=description content="notes to self"><meta property="og:url" content="https://knrdl.github.io/posts/pinephone-edge-server/"><meta property="og:site_name" content="knrdlog"><meta property="og:title" content="PinePhone as edge server in a remote network"><meta property="og:description" content="The straight forward way to access a remote network is to setup a VPN connection with the router. If thatâ€™s not possible, a separate device is required to act as VPN client. A smartphone is particularly suitable for this as it is always on, small, has a low power consumption and makes it easy to configure a wifi connection with the network. The PinePhone is especially suitable for the job as it can host a standard Linux environment which is not messed up like Android. On the PinePhone we need very few tools to work in the remote network:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-20T00:00:00+00:00"><meta property="article:modified_time" content="2024-12-20T22:28:03+01:00"><meta property="article:tag" content="Pinephone"><meta property="article:tag" content="Ssh"><meta property="article:tag" content="Docker"><meta property="article:tag" content="Wireguard"><meta name=author content="knrdl"><link rel=stylesheet href=https://knrdl.github.io/styles.min.b1eb305989f01c7be31a7a19d4ab34ca470eddd06327253c7bcf3d1c5a41d28c.css integrity="sha256-seswWYnwHHvjGnoZ1Ks0ykcO3dBjJyU8e889HFpB0ow="></head><body><header><div class=site-header><span><a href=https://knrdl.github.io/ class=site-title>knrdlog</a>
</span><span><nav class=right-menu><span class=menu-item><a href=/tags/>tags</a></span>
<span class=menu-item><a href=https://github.com/knrdl target=_blank rel="noopener noreferrer">github</a></span>
<span class=menu-item><a href=/index.xml>rss</a></span></nav></span></div><div class=separator>================================================================================================================================================================</div></header><main><article><div class=post-header><h1>PinePhone as edge server in a remote network</h1><time datetime=2024-12-20 class=pubdate>2024-12-20</time>
<span class=tags><a href=/tags/docker class=hashtag>docker</a>
<a href=/tags/pinephone class=hashtag>pinephone</a>
<a href=/tags/ssh class=hashtag>ssh</a>
<a href=/tags/wireguard class=hashtag>wireguard</a></span></div><p>The straight forward way to access a remote network is to setup a VPN connection with the router. If that&rsquo;s not possible, a separate device is required to act as VPN client. A smartphone is particularly suitable for this as it is always on, small, has a low power consumption and makes it easy to configure a wifi connection with the network. The PinePhone is especially suitable for the job as it can host a standard Linux environment which is not messed up like Android. On the PinePhone we need very few tools to work in the remote network:</p><ol><li><strong>Wireguard</strong> for the VPN tunnel</li><li><strong>SSH</strong> server</li><li><strong>Docker</strong> runtime, e.g. to run a time series database to collect sensor stats</li></ol><h2 id=setup class=paragraph-header>Setup <a href=#setup></a></h2><ol><li>flash PostmarketOS to a microSD card</li><li>run the wizard on the phone (to resize the root partition)</li><li>copy the PostmarketOS img-file to the microSD card</li><li>flash the img-file to the eMMC via <code>dd</code>:
<a href=https://pine64.org/documentation/PinePhone/Installation/Installation_to_the_eMMC/#from-the-booted-microsd-os target=_blank rel="noopener noreferrer">https://pine64.org/documentation/PinePhone/Installation/Installation_to_the_eMMC/#from-the-booted-microsd-os</a></li><li>remove the sd card and reboot</li><li>login (user:147147) and connect wifi</li></ol><h3 id=ssh class=paragraph-header>SSH <a href=#ssh></a></h3><ol><li>start ssh server: <code>sudo service sshd start</code></li><li>enable ssh on boot: <code>sudo rc-update add sshd</code></li><li>connect to the phone: <code>ssh user@pine64-pinephone</code></li><li>in <code>/etc/ssh/sshd_config</code>: set <code>AllowTcpForwarding yes</code> to forward ports from the remote network to your local host</li></ol><h3 id=system class=paragraph-header>System <a href=#system></a></h3><ol><li>check updates: <code>sudo apk update</code> and <code>sudo apk upgrade -a</code></li><li>install some tools: <code>sudo apk add htop curl nano</code></li><li>remove unnecessary apps: <code>sudo apk del gnome-maps gnome-calculator gnome-software gnome-clocks gnome-calendar gnome-text-editor gnome-contacts gnome-weather chatty portfolio lollypop firefox-esr evince calls megapixels postmarketos-default-camera postmarketos-welcome loupe flatpak</code></li><li>list remaining packages: <code>sudo apk list -I</code></li><li>disable unnecessary services: <code>sudo rc-update del bluetooth</code> and <code>sudo rc-update del modemmanager</code></li><li>list enabled services: <code>sudo rc-update show</code></li></ol><h3 id=wireguard class=paragraph-header>Wireguard <a href=#wireguard></a></h3><ol><li>install: <code>sudo apk add wireguard-tools-wg-quick wireguard-tools-openrc</code></li><li>add wireguard config to <code>/etc/wireguard/wg0.conf</code>, e.g.:</li></ol><pre tabindex=0><code class=language-conf data-lang=conf>[Interface]
PrivateKey = XXXXXXXXXXXXXXXXXXXXXXXXXXXXX
Address = 192.168.178.204/24
DNS = 192.168.178.1
DNS = fritz.box

[Peer]
PublicKey = XXXXXXXXXXXXXXXXXXXXXXXXXXXXX
PresharedKey = XXXXXXXXXXXXXXXXXXXXXXXXXXXXX
AllowedIPs = 192.168.178.0/24,0.0.0.0/0
Endpoint = XXXXXXXXXXXXXXXXXXXXXXXXXXXXX.myfritz.net:12345
PersistentKeepalive = 25
</code></pre><ol start=3><li>fix permissions: <code>sudo chmod o-r /etc/wireguard/wg0.conf</code></li><li><a href=https://wiki.alpinelinux.org/wiki/Configure_a_Wireguard_interface_%28wg%29 target=_blank rel="noopener noreferrer">autostart</a>:</li></ol><pre tabindex=0><code>sudo ln -s /etc/init.d/wg-quick /etc/init.d/wg-quick.wg0
sudo rc-update add wg-quick.wg0
sudo service wg-quick.wg0 start
</code></pre><ol start=5><li>manual start: <code>sudo wg-quick up wg0</code></li><li>manual stop: <code>sudo wg-quick down wg0</code></li></ol><h3 id=docker class=paragraph-header>Docker <a href=#docker></a></h3><ol><li>install: <code>sudo apk add docker</code> (alpine sources typically provide an up-to-date version)</li><li>autostart: <code>sudo rc-update add docker</code></li><li>start: <code>sudo service docker start</code></li><li>the PinePhone can execute arm32v7 and also arm64v8 images</li></ol><div class=comments><a href="https://github.com/knrdl/knrdl.github.io/issues/new?title=PinePhone+as+edge+server+in+a+remote+network" target=_blank rel="noopener noreferrer"><img src=https://knrdl.github.io/github.png alt="Github logo" style=filter:invert(.7) width=17 height=17>
<span>Feedback</span></a></div></article></main><hr><footer>Licensed under <a href=https://creativecommons.org/publicdomain/zero/1.0/ target=_blank rel='noopener norefferer'>CC0 1.0</a> |
<a href=https://gohugo.io target=_blank rel='noopener norefferer'>Hugo</a> theme inspired by <a href=https://github.com/vamc19 target=_blank rel='noopener norefferer'>vamc19</a> |
Hosted by <a href=https://pages.github.com target=_blank rel='noopener norefferer'>Github</a> (<a href=https://github.com/site/privacy target=_blank rel='noopener norefferer'>Privacy Policy</a>)</footer></body></html>