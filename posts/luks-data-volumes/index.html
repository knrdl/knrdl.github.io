<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=content-security-policy content="default-src 'none'; style-src 'self' 'unsafe-inline'; img-src 'self' https:; font-src 'self'; script-src 'unsafe-inline'"><link rel="shortcut icon" type=image/png href=/favicon.png><link rel=sitemap type=application/xml href=/sitemap.xml title=knrdlog><title>LUKS: Encrypted data volumes</title><meta name=description content="notes to self"><meta property="og:title" content="LUKS: Encrypted data volumes"><meta property="og:description" content="To realize encrypted data volumes, there are various tools for different use cases:
Veracrypt works cross-platform, predefined volume sizes Gocryptfs encrypts transparent, dynamic storage usage Restic encrypts backups, network capable, can do versioning LUKS provides full disk encryption for linux systems But LUKS can also be used for regular data volumes which behave a lot like Veracrypt volumes.
1. Create a volume mkdir -p ~/volumes/ # here the encrypted volume files will be stored sudo apt-get install cryptsetup pv dd if=/dev/zero bs=1M count=10240 | pv | dd of=~/volumes/vol1."><meta property="og:type" content="article"><meta property="og:url" content="https://knrdl.github.io/posts/luks-data-volumes/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-01T00:00:00+00:00"><meta property="article:modified_time" content="2023-01-08T12:23:47+01:00"><meta name=author content="knrdl"><link rel=stylesheet href=https://knrdl.github.io/styles.min.b1eb305989f01c7be31a7a19d4ab34ca470eddd06327253c7bcf3d1c5a41d28c.css integrity="sha256-seswWYnwHHvjGnoZ1Ks0ykcO3dBjJyU8e889HFpB0ow="></head><body><header><div class=site-header><span><a href=https://knrdl.github.io/ class=site-title>knrdlog</a></span>
<span><nav class=right-menu><span class=menu-item><a href=/tags/>tags</a></span>
<span class=menu-item><a href=https://github.com/knrdl target=_blank rel="noopener noreferrer">github</a></span>
<span class=menu-item><a href=/index.xml>rss</a></span></nav></span></div><div class=separator>================================================================================================================================================================</div></header><main><article><div class=post-header><h1>LUKS: Encrypted data volumes</h1><time datetime=2022-10-01 class=pubdate>2022-10-01</time>
<a href=https://github.com/knrdl/knrdl.github.io/commits/main/content/posts/luks-data-volumes.md target=_blank rel="noopener noreferrer"><time datetime=2023-01-08 class=lastmod>{üìù2023-01-08}</time></a>
<span class=tags><a href=/tags/linux class=hashtag>linux</a>
<a href=/tags/luks class=hashtag>luks</a></span></div><p>To realize encrypted data volumes, there are various tools for different use cases:</p><ul><li><strong>Veracrypt</strong> works cross-platform, predefined volume sizes</li><li><strong>Gocryptfs</strong> encrypts transparent, dynamic storage usage</li><li><strong>Restic</strong> encrypts backups, network capable, can do versioning</li><li><strong>LUKS</strong> provides full disk encryption for linux systems</li></ul><p>But LUKS can also be used for regular data volumes which behave a lot like Veracrypt volumes.</p><h3 id=1-create-a-volume class=paragraph-header>1. Create a volume <a href=#1-create-a-volume></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir -p ~/volumes/  <span style=color:#6272a4># here the encrypted volume files will be stored</span>
</span></span><span style=display:flex><span>sudo apt-get install cryptsetup pv
</span></span><span style=display:flex><span>dd <span style=color:#ff79c6>if</span><span style=color:#ff79c6>=</span>/dev/zero <span style=color:#8be9fd;font-style:italic>bs</span><span style=color:#ff79c6>=</span>1M <span style=color:#8be9fd;font-style:italic>count</span><span style=color:#ff79c6>=</span><span style=color:#bd93f9>10240</span> | pv | dd <span style=color:#8be9fd;font-style:italic>of</span><span style=color:#ff79c6>=</span>~/volumes/vol1.luks  <span style=color:#6272a4># will create a 1MiB * 10240 = 10GiB file, called &#34;vol1.luks&#34;</span>
</span></span><span style=display:flex><span>cryptsetup -y -v luksFormat ~/volumes/vol1.luks  <span style=color:#6272a4># here you have to enter the passphrase to protect the new volume</span>
</span></span><span style=display:flex><span>sudo cryptsetup luksOpen ~/volumes/vol1.luks vol1  <span style=color:#6272a4># provide the volume as a device located at /dev/mapper/vol1</span>
</span></span><span style=display:flex><span>sudo cryptsetup -v status vol1
</span></span><span style=display:flex><span>sudo mkfs.ext4 /dev/mapper/vol1  <span style=color:#6272a4># create filesystem inside the volume</span>
</span></span><span style=display:flex><span>mkdir -p ~/volumes/vol1/  <span style=color:#6272a4># the volume will also be mounted in the &#34;volumes&#34; directory</span>
</span></span><span style=display:flex><span>sudo mount /dev/mapper/vol1 ~/volumes/vol1/
</span></span><span style=display:flex><span>sudo chown <span style=color:#8be9fd;font-style:italic>$USER</span>:<span style=color:#8be9fd;font-style:italic>$USER</span> -R ~/volumes/vol1/  <span style=color:#6272a4># give current user ownership to work with the volume</span>
</span></span><span style=display:flex><span>df -H  <span style=color:#6272a4># shows disk usage inside the volume</span>
</span></span><span style=display:flex><span>sudo umount /dev/mapper/vol1
</span></span><span style=display:flex><span>sudo cryptsetup luksClose vol1
</span></span></code></pre></div><p><code>pv</code> adds the progress bar for <code>dd</code> and can be omitted.</p><p>The blocksize provided to <code>dd</code> will be overwritten when creating a filesystem inside the container. So it has no impact on the performance later on.</p><p>The command &ldquo;luksFormat&rdquo; will figure out good encryption parameters per default. But this requires a decent up-to-date version.</p><h3 id=2-open-the-volume class=paragraph-header>2. Open the volume <a href=#2-open-the-volume></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo cryptsetup luksOpen ~/volumes/vol1.luks vol1
</span></span><span style=display:flex><span>sudo mount /dev/mapper/vol1 ~/volumes/vol1/
</span></span></code></pre></div><h3 id=3-close-the-volume class=paragraph-header>3. Close the volume <a href=#3-close-the-volume></a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo umount /dev/mapper/vol1
</span></span><span style=display:flex><span>sudo cryptsetup luksClose vol1
</span></span></code></pre></div><div class=comments><a href="https://github.com/knrdl/knrdl.github.io/issues/new?title=LUKS%3A+Encrypted+data+volumes" target=_blank rel="noopener noreferrer"><img src=https://knrdl.github.io/github.png alt="Github logo" style=filter:invert(.7) width=17 height=17>
<span>Feedback</span></a></div></article></main><hr><footer>Licensed under <a href=https://creativecommons.org/publicdomain/zero/1.0/ target=_blank rel='noopener norefferer'>CC0 1.0</a> |
<a href=https://gohugo.io target=_blank rel='noopener norefferer'>Hugo</a> theme inspired by <a href=https://github.com/vamc19 target=_blank rel='noopener norefferer'>vamc19</a> |
Hosted by <a href=https://pages.github.com target=_blank rel='noopener norefferer'>Github</a> (<a href=https://github.com/site/privacy target=_blank rel='noopener norefferer'>Privacy Policy</a>)</footer></body></html>