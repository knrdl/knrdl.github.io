<!doctype html><html lang=en-us><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta http-equiv=Content-Security-Policy content="default-src 'none'; style-src 'self' 'unsafe-inline'; img-src 'self' https:; font-src 'self'; script-src 'unsafe-inline'"><link rel="shortcut icon" type=image/png href=/favicon.png><link rel=sitemap type=application/xml href=/sitemap.xml title=knrdlog><title>Gitlab: Generate repository list report</title><meta name=description content="notes to self"><meta property="og:url" content="https://knrdl.github.io/posts/gitlab-repo-list/"><meta property="og:site_name" content="knrdlog"><meta property="og:title" content="Gitlab: Generate repository list report"><meta property="og:description" content="You must be admin to get a list of all repositories You need a personal access token: Gitlab WebUI → Preferences → Access Tokens → Select scopes: api or read_api → Create personal access token Run the script: import json import requests import csv token = 'YOUR_PERSONAL_ACCESS_TOKEN' page = 1 repos = [] users = {} while True: print('Page:', page) res = requests.get(f'https://gitlab.example.org/api/v4/projects?page={page}&amp;per_page=100&amp;private_token={token}') assert res.status_code == 200 records = res.json() if records: for record in records: creator_id = record['creator_id'] if creator_id: # attach creator user record to the repo if creator_id not in users: user_res = requests.get(f'https://gitlab.example.org/api/v4/users/{creator_id}?private_token={token}') assert user_res.status_code == 200 users[creator_id] = user_res.json() record['creator'] = users[creator_id] else: record['creator'] = None repos.append(record) else: break page+=1 with open('repos.json', 'w') as f: json.dump(repos, f) with open('repos.csv', 'w') as f: csvw = csv.writer(f, delimiter=',', quotechar='&#34;', quoting=csv.QUOTE_MINIMAL) csvw.writerow(['Title', 'Url', 'Creator', 'Created', 'Last Activity', 'Private']) for repo in repos: if not repo['archived'] and not repo['empty_repo']: # filter out archived repos and repos without files (e.g. issue only repos) csvw.writerow([ repo['name_with_namespace'], repo['web_url'], f&#34;{repo['creator']['name']} ({repo['creator']['username']})&#34; if repo['creator'] else '', repo['created_at'].split('T')[0], repo['last_activity_at'].split('T')[0], repo['visibility'] == 'private' and repo['namespace']['path'] == repo.get('owner', {}).get('username') ])"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-12T00:00:00+00:00"><meta property="article:modified_time" content="2023-05-12T12:38:34+02:00"><meta property="article:tag" content="Gitlab"><meta property="article:tag" content="Python"><meta name=author content="knrdl"><link rel=stylesheet href=https://knrdl.github.io/styles.min.b1eb305989f01c7be31a7a19d4ab34ca470eddd06327253c7bcf3d1c5a41d28c.css integrity="sha256-seswWYnwHHvjGnoZ1Ks0ykcO3dBjJyU8e889HFpB0ow="></head><body><header><div class=site-header><span><a href=https://knrdl.github.io/ class=site-title>knrdlog</a>
</span><span><nav class=right-menu><span class=menu-item><a href=/tags/>tags</a></span>
<span class=menu-item><a href=https://github.com/knrdl target=_blank rel="noopener noreferrer">github</a></span>
<span class=menu-item><a href=/index.xml>rss</a></span></nav></span></div><div class=separator>================================================================================================================================================================</div></header><main><article><div class=post-header><h1>Gitlab: Generate repository list report</h1><time datetime=2023-05-12 class=pubdate>2023-05-12</time>
<span class=tags><a href=/tags/gitlab class=hashtag>gitlab</a>
<a href=/tags/python class=hashtag>python</a></span></div><ol><li>You must be admin to get a list of all repositories</li><li>You need a personal access token: Gitlab WebUI → Preferences → Access Tokens → Select scopes: <code>api</code> or <code>read_api</code> → Create personal access token</li><li>Run the script:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>import</span> json
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> requests
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> csv
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>token <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;YOUR_PERSONAL_ACCESS_TOKEN&#39;</span>
</span></span><span style=display:flex><span>page <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>repos <span style=color:#ff79c6>=</span> []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>users <span style=color:#ff79c6>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>while</span> <span style=color:#ff79c6>True</span>:
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#39;Page:&#39;</span>, page)
</span></span><span style=display:flex><span>    res <span style=color:#ff79c6>=</span> requests<span style=color:#ff79c6>.</span>get(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#39;https://gitlab.example.org/api/v4/projects?page=</span><span style=color:#f1fa8c>{</span>page<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&amp;per_page=100&amp;private_token=</span><span style=color:#f1fa8c>{</span>token<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>assert</span> res<span style=color:#ff79c6>.</span>status_code <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>200</span>
</span></span><span style=display:flex><span>    records <span style=color:#ff79c6>=</span> res<span style=color:#ff79c6>.</span>json()
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> records:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> record <span style=color:#ff79c6>in</span> records:
</span></span><span style=display:flex><span>            creator_id <span style=color:#ff79c6>=</span> record[<span style=color:#f1fa8c>&#39;creator_id&#39;</span>]
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> creator_id:  <span style=color:#6272a4># attach creator user record to the repo</span>
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>if</span> creator_id <span style=color:#ff79c6>not</span> <span style=color:#ff79c6>in</span> users:
</span></span><span style=display:flex><span>                    user_res <span style=color:#ff79c6>=</span> requests<span style=color:#ff79c6>.</span>get(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#39;https://gitlab.example.org/api/v4/users/</span><span style=color:#f1fa8c>{</span>creator_id<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>?private_token=</span><span style=color:#f1fa8c>{</span>token<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#39;</span>)
</span></span><span style=display:flex><span>                    <span style=color:#ff79c6>assert</span> user_res<span style=color:#ff79c6>.</span>status_code <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>200</span>
</span></span><span style=display:flex><span>                    users[creator_id] <span style=color:#ff79c6>=</span> user_res<span style=color:#ff79c6>.</span>json()
</span></span><span style=display:flex><span>                record[<span style=color:#f1fa8c>&#39;creator&#39;</span>] <span style=color:#ff79c6>=</span> users[creator_id]
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>else</span>:
</span></span><span style=display:flex><span>                record[<span style=color:#f1fa8c>&#39;creator&#39;</span>] <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>None</span>
</span></span><span style=display:flex><span>            repos<span style=color:#ff79c6>.</span>append(record)
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>break</span>
</span></span><span style=display:flex><span>    page<span style=color:#ff79c6>+=</span><span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>with</span> <span style=color:#8be9fd;font-style:italic>open</span>(<span style=color:#f1fa8c>&#39;repos.json&#39;</span>, <span style=color:#f1fa8c>&#39;w&#39;</span>) <span style=color:#ff79c6>as</span> f:
</span></span><span style=display:flex><span>    json<span style=color:#ff79c6>.</span>dump(repos, f)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>with</span> <span style=color:#8be9fd;font-style:italic>open</span>(<span style=color:#f1fa8c>&#39;repos.csv&#39;</span>, <span style=color:#f1fa8c>&#39;w&#39;</span>) <span style=color:#ff79c6>as</span> f:
</span></span><span style=display:flex><span>    csvw <span style=color:#ff79c6>=</span> csv<span style=color:#ff79c6>.</span>writer(f, delimiter<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;,&#39;</span>, quotechar<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;&#34;&#39;</span>, quoting<span style=color:#ff79c6>=</span>csv<span style=color:#ff79c6>.</span>QUOTE_MINIMAL)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    csvw<span style=color:#ff79c6>.</span>writerow([<span style=color:#f1fa8c>&#39;Title&#39;</span>, <span style=color:#f1fa8c>&#39;Url&#39;</span>, <span style=color:#f1fa8c>&#39;Creator&#39;</span>, <span style=color:#f1fa8c>&#39;Created&#39;</span>, <span style=color:#f1fa8c>&#39;Last Activity&#39;</span>, <span style=color:#f1fa8c>&#39;Private&#39;</span>])
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> repo <span style=color:#ff79c6>in</span> repos:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> <span style=color:#ff79c6>not</span> repo[<span style=color:#f1fa8c>&#39;archived&#39;</span>] <span style=color:#ff79c6>and</span> <span style=color:#ff79c6>not</span> repo[<span style=color:#f1fa8c>&#39;empty_repo&#39;</span>]:  <span style=color:#6272a4># filter out archived repos and repos without files (e.g. issue only repos)</span>
</span></span><span style=display:flex><span>            csvw<span style=color:#ff79c6>.</span>writerow([
</span></span><span style=display:flex><span>                repo[<span style=color:#f1fa8c>&#39;name_with_namespace&#39;</span>], 
</span></span><span style=display:flex><span>                repo[<span style=color:#f1fa8c>&#39;web_url&#39;</span>], 
</span></span><span style=display:flex><span>                <span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>{</span>repo[<span style=color:#f1fa8c>&#39;creator&#39;</span>][<span style=color:#f1fa8c>&#39;name&#39;</span>]<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c> (</span><span style=color:#f1fa8c>{</span>repo[<span style=color:#f1fa8c>&#39;creator&#39;</span>][<span style=color:#f1fa8c>&#39;username&#39;</span>]<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>)&#34;</span> <span style=color:#ff79c6>if</span> repo[<span style=color:#f1fa8c>&#39;creator&#39;</span>] <span style=color:#ff79c6>else</span> <span style=color:#f1fa8c>&#39;&#39;</span>, 
</span></span><span style=display:flex><span>                repo[<span style=color:#f1fa8c>&#39;created_at&#39;</span>]<span style=color:#ff79c6>.</span>split(<span style=color:#f1fa8c>&#39;T&#39;</span>)[<span style=color:#bd93f9>0</span>], 
</span></span><span style=display:flex><span>                repo[<span style=color:#f1fa8c>&#39;last_activity_at&#39;</span>]<span style=color:#ff79c6>.</span>split(<span style=color:#f1fa8c>&#39;T&#39;</span>)[<span style=color:#bd93f9>0</span>], 
</span></span><span style=display:flex><span>                repo[<span style=color:#f1fa8c>&#39;visibility&#39;</span>] <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#39;private&#39;</span> <span style=color:#ff79c6>and</span> repo[<span style=color:#f1fa8c>&#39;namespace&#39;</span>][<span style=color:#f1fa8c>&#39;path&#39;</span>] <span style=color:#ff79c6>==</span> repo<span style=color:#ff79c6>.</span>get(<span style=color:#f1fa8c>&#39;owner&#39;</span>, {})<span style=color:#ff79c6>.</span>get(<span style=color:#f1fa8c>&#39;username&#39;</span>)
</span></span><span style=display:flex><span>            ])
</span></span></code></pre></div><div class=comments><a href="https://github.com/knrdl/knrdl.github.io/issues/new?title=Gitlab%3A+Generate+repository+list+report" target=_blank rel="noopener noreferrer"><img src=https://knrdl.github.io/github.png alt="Github logo" style=filter:invert(.7) width=17 height=17>
<span>Feedback</span></a></div></article></main><hr><footer>Licensed under <a href=https://creativecommons.org/publicdomain/zero/1.0/ target=_blank rel='noopener norefferer'>CC0 1.0</a> |
<a href=https://gohugo.io target=_blank rel='noopener norefferer'>Hugo</a> theme inspired by <a href=https://github.com/vamc19 target=_blank rel='noopener norefferer'>vamc19</a> |
Hosted by <a href=https://pages.github.com target=_blank rel='noopener norefferer'>Github</a> (<a href=https://github.com/site/privacy target=_blank rel='noopener norefferer'>Privacy Policy</a>)</footer></body></html>