<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=content-security-policy content="default-src 'none'; style-src 'self' 'unsafe-inline'; img-src 'self' https:; font-src 'self'; script-src 'unsafe-inline'"><link rel="shortcut icon" type=image/png href=/favicon.png><link rel=sitemap type=application/xml href=/sitemap.xml title=knrdlog><title>Microsoft Office won't open links with SSO</title><meta name=description content="notes to self"><meta property="og:title" content="Microsoft Office won't open links with SSO"><meta property="og:description" content="M$ Office is tightly bundled with Internet Explorer. So it used to open links in office documents in a separate IE8 instance. That was already problematic as cookies were not preserved. So the user has to login every time he clicks on a link in a excel sheet if the website has authentication in place.
Nowadays the Internet Explorer is finally dead (at least I hope so). When you click on a link in an excel sheet the default browser will pop up."><meta property="og:type" content="article"><meta property="og:url" content="https://knrdl.github.io/posts/msoffice-wont-open-links-with-sso/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-28T00:00:00+00:00"><meta property="article:modified_time" content="2023-02-28T22:03:31+01:00"><meta name=author content="knrdl"><link rel=stylesheet href=https://knrdl.github.io/styles.min.b1eb305989f01c7be31a7a19d4ab34ca470eddd06327253c7bcf3d1c5a41d28c.css integrity="sha256-seswWYnwHHvjGnoZ1Ks0ykcO3dBjJyU8e889HFpB0ow="></head><body><header><div class=site-header><span><a href=https://knrdl.github.io/ class=site-title>knrdlog</a></span>
<span><nav class=right-menu><span class=menu-item><a href=/tags/>tags</a></span>
<span class=menu-item><a href=https://github.com/knrdl target=_blank rel="noopener noreferrer">github</a></span>
<span class=menu-item><a href=/index.xml>rss</a></span></nav></span></div><div class=separator>================================================================================================================================================================</div></header><main><article><div class=post-header><h1>Microsoft Office won't open links with SSO</h1><time datetime=2023-02-28 class=pubdate>2023-02-28</time>
<span class=tags><a href=/tags/microsoft class=hashtag>microsoft</a>
<a href=/tags/nginx class=hashtag>nginx</a></span></div><p>M$ Office is tightly bundled with Internet Explorer. So it used to open links in office documents in a separate IE8 instance. That was already problematic as cookies were not preserved. So the user has to login every time he clicks on a link in a excel sheet if the website has authentication in place.</p><p>Nowadays the Internet Explorer is finally dead (at least I hope so). When you click on a link in an excel sheet the default browser will pop up. But M$ office still preprocesses links. After you click the link in the excel sheet M$ office will trigger a HTTP request to the link target. If the request is successful the browser will open the link. If it fails with a 4xx or 5xx status code M$ office will just show a error message. The built in user agent will also follow http 3xx redirects. If these end up on a SSO portal with status code 4xx the problem is the same.</p><p>Micro$oft offers a * fantastic * solution: Just change a registry key on every machine which might open that excel file. What we can do instead is presenting to M$ office always a 200 response:</p><ul><li>When doing the request the M$ office user agent uses a dedicated User Agent String which contains the M$ product name. So a filter can be applied.</li><li>Provide a dedicated domain for links in M$ office files. E.g.
<a href=https://appname-msoffice.example.org target=_blank rel="noopener noreferrer">https://appname-msoffice.example.org</a> instead of
<a href=https://appname.example.org target=_blank rel="noopener noreferrer">https://appname.example.org</a>. A request to this dedicated domain can return a 200 and trigger a Javascript redirect. Nginx code snippet:</li></ul><pre tabindex=0><code>server {
    server_name appname-msoffice.example.org;
    location / {
        add_header Content-Type text/html;
        return 200 &#39;&lt;html&gt;&lt;body&gt;Please wait ...&lt;/body&gt;&lt;script&gt;window.location=window.location.href.replace(&#34;-msoffice&#34;, &#34;&#34;)&lt;/script&gt;&lt;/html&gt;&#39;;
    }
}
</code></pre><div class=comments><a href="https://github.com/knrdl/knrdl.github.io/issues/new?title=Microsoft+Office+won%27t+open+links+with+SSO" target=_blank rel="noopener noreferrer"><img src=https://knrdl.github.io/github.png alt="Github logo" style=filter:invert(.7) width=17 height=17>
<span>Feedback</span></a></div></article></main><hr><footer>Licensed under <a href=https://creativecommons.org/publicdomain/zero/1.0/ target=_blank rel='noopener norefferer'>CC0 1.0</a> |
<a href=https://gohugo.io target=_blank rel='noopener norefferer'>Hugo</a> theme inspired by <a href=https://github.com/vamc19 target=_blank rel='noopener norefferer'>vamc19</a> |
Hosted by <a href=https://pages.github.com target=_blank rel='noopener norefferer'>Github</a> (<a href=https://github.com/site/privacy target=_blank rel='noopener norefferer'>Privacy Policy</a>)</footer></body></html>